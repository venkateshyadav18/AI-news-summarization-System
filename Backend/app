from flask import Flask, request, jsonify, render_template
from flask_cors import CORS
import os
import sys
sys.path.append(os.path.dirname(__file__))

from models.summarizer import NewsSummarizer
from models.sentiment_analyzer import SentimentAnalyzer
from models.credibility_scorer import CredibilityScorer
from utils.preprocessing import TextPreprocessor
from utils.news_fetcher import NewsFetcher
# ...existing code...
from config.config import Config
# ...existing code...





app = Flask(__name__)
CORS(app)

# Initialize models
summarizer = NewsSummarizer()
sentiment_analyzer = SentimentAnalyzer()
credibility_scorer = CredibilityScorer()
preprocessor = TextPreprocessor()
news_fetcher = NewsFetcher()

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/analyze', methods=['POST'])
def analyze_news():
    try:
        data = request.json
        url = data.get('url')
        text = data.get('text')
        category = data.get('category', 'general')
        
        if url and not text:
            text = news_fetcher.fetch_article(url)
        
        if not text:
            return jsonify({'error': 'No text content provided'}), 400
        
        processed_text = preprocessor.clean_text(text)
        
        summary = summarizer.generate_summary(processed_text)
        sentiment = sentiment_analyzer.analyze_sentiment(processed_text)
        credibility = credibility_scorer.score_credibility(processed_text, category)
        keywords = preprocessor.extract_keywords(processed_text)
        
        response = {
            'summary': summary,
            'sentiment': sentiment,
            'credibility': credibility,
            'keywords': keywords,
            'word_count': len(text.split()),
            'processing_time': 0.5
        }
        return jsonify(response)
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
